<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Environment Stats Dashboard</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --page-bg: #022B3A;
      --title-box: #BFDBF7;
      --title-color: #022B3A;
      --card-bg: #1F7A8C;
      --card-text: #BFDBF7;
      --card-accent-text: #022B3A;
      --muted: #E1E5F2;
      --glass: rgba(255,255,255,0.03);
      --radius: 12px;
      font-family: 'Playfair Display', serif;
    }

    html,body{height:100%;margin:0;padding:24px;background:var(--page-bg);color:var(--card-text)}
    .wrap{max-width:1100px;margin:0 auto}

    .title-box{
      background:var(--title-box);
      color:var(--title-color);
      font-family: 'Oswald', sans-serif;
      text-align:center;
      padding:22px 18px;
      border-radius:10px;
      font-weight:700;
      font-size:28px;
      box-shadow:0 6px 18px rgba(0,0,0,0.25);
      margin-bottom:20px;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      grid-auto-rows: 160px;
      gap:18px;
      align-items:start;
    }

    /* make the single bottom card centered and full width on its own row */
    .grid .span-full{grid-column:1 / -1;display:flex;justify-content:center}

    .card{
      background:var(--card-bg);
      border-radius:var(--radius);
      padding:16px;
      box-shadow:0 6px 18px rgba(0,0,0,0.25);
      color:var(--card-text);
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      text-align:center;
      position:relative;
    }

    /* FIXED: Make the Mode card match the others */
    #card-mode { height: 126px; }

    .card h3{margin:0 0 12px 0;font-size:18px;color:var(--card-accent-text)}
    .big-value{font-size:34px;font-weight:700;color:var(--card-accent-text)}
    .small{font-size:12px;opacity:0.85}

    /* Mode button */
    .mode-btn{
      background:var(--title-box);
      color:var(--title-color);
      border:none;padding:10px 18px;border-radius:10px;cursor:pointer;font-weight:700;font-size:16px;
      box-shadow:0 4px 8px rgba(0,0,0,0.18);
    }

    /* Toggle switch */
    .switch{
      --w:84px;--h:36px;display:inline-block;
    }
    .switch input{display:none}
    .switch-label{
      display:block;width:var(--w);height:var(--h);background:var(--muted);border-radius:999px;position:relative;cursor:pointer;box-shadow:inset 0 2px 8px rgba(0,0,0,0.2);
      transition:background 180ms ease;
    }
    .switch-label::after{
      content:'';position:absolute;left:6px;top:6px;width:24px;height:24px;border-radius:50%;background:var(--card-accent-text);transition:all 180ms ease;box-shadow:0 4px 8px rgba(0,0,0,0.35);
    }
    .switch.on .switch-label{background:var(--card-accent-text)}
    .switch.on .switch-label::after{transform:translateX(48px);background:var(--muted)}

    /* disabled look */
    .switch.disabled .switch-label{background:var(--muted);cursor:not-allowed}
    .switch.disabled .switch-label::after{background:#a8b0be}

    .led-texts{display:flex;gap:12px;align-items:center;margin-top:10px}
    .led-texts span{font-weight:700;color:var(--card-accent-text)}

    /* Layout adjustments for bottom card center */
    @media(min-width:760px){
      .grid .span-full{grid-column:1/3}
      .grid{grid-template-rows: repeat(2, 160px) 140px}
      .grid .bottom-center{justify-self:center;width:50%}
    }

    @media(max-width:760px){
      .grid{grid-template-columns:1fr;grid-auto-rows:140px}
      .grid .span-full{grid-column:1}
      .grid .bottom-center{width:100%}
    }

    .note{font-size:12px;opacity:0.9;margin-top:8px;color:var(--card-text)}

    .status{position:absolute;right:12px;top:12px;font-size:12px;color:var(--card-text);opacity:0.8}

  </style>
</head>
<body>
  <div class="wrap">
    <div class="title-box">üå± Environment Stats üå±</div>

    <div class="grid">
      <!-- Card 1: Mode -->
      <div class="card" id="card-mode">
        <div class="status" id="mode-status">Mode</div>
        <h3>Mode</h3>
        <button class="mode-btn" id="modeBtn">Automatic</button>
        <div class="note">Click to toggle between Automatic and Manual</div>
      </div>

      <!-- Card 2: LED -->
      <div class="card" id="card-led">
        <h3 style="color:var(--card-accent-text)">LED</h3>
        <div id="ledSwitch" class="switch" role="switch" aria-checked="false">
          <label class="switch-label"></label>
        </div>
        <div class="led-texts">
          <span>OFF</span>
          <span style="margin-left:8px">ON</span>
        </div>
        <div class="note" id="led-note">LED control disabled in Automatic mode</div>
      </div>

      <!-- Card 3: Humidity -->
      <div class="card" id="card-humidity">
        <h3 style="color:var(--card-accent-text)">Humidity Reading üíß</h3>
        <div class="big-value" id="humidityVal">-- %</div>
        <div class="note">Source: DHT11 sensor</div>
      </div>

      <!-- Card 4: Temperature -->
      <div class="card" id="card-temp">
        <h3 style="color:var(--card-accent-text)">Temperature Reading üå°Ô∏è</h3>
        <div class="big-value" id="tempVal">-- ¬∞C</div>
        <div class="note">Source: DHT11 sensor</div>
      </div>

      <!-- Card 5: Gas Value (bottom center) -->
      <div class="card span-full bottom-center" id="card-gas" style="width:100%">
        <h3 style="color:var(--card-accent-text)">Gas Value üí®</h3>
        <div class="big-value" id="gasVal">--</div>
        <div class="note">Source: MQ-series gas sensor</div>
      </div>

    </div>

    <div style="height:18px"></div>
  </div>

<script>
const UID = 'NB09';
const BASE = 'https://iot.roboninja.in/index.php';
const POLL_INTERVAL = 5000;

const modeBtn = document.getElementById('modeBtn');
const ledSwitch = document.getElementById('ledSwitch');
const ledNote = document.getElementById('led-note');
const humidityVal = document.getElementById('humidityVal');
const tempVal = document.getElementById('tempVal');
const gasVal = document.getElementById('gasVal');

let isAutomatic = true;
let ledOn = false;

async function sendWrite(paramStr){
  const url = `${BASE}?action=write&UID=${UID}&${paramStr}`;
  try{
    const resp = await fetch(url, {method:'GET'});
    if(!resp.ok){ console.warn('Write request failed', url, resp.status); }
    return resp.text();
  }catch(err){ console.warn('Write error', err); return null; }
}

async function sendRead(paramName){
  const url = `${BASE}?action=read&UID=${UID}&${paramName}`;
  try{
    const resp = await fetch(url, {method:'GET'});
    if(!resp.ok){ console.warn('Read failed', url, resp.status); return null; }
    const text = await resp.text(); return text.trim();
  }catch(err){ console.warn('Read error', err); return null; }
}

function refreshLedUI(){
  if(isAutomatic){
    ledSwitch.classList.add('disabled');
    ledNote.textContent = 'LED control disabled in Automatic mode';
    ledSwitch.setAttribute('aria-disabled', 'true');
  } else {
    ledSwitch.classList.remove('disabled');
    ledNote.textContent = 'Manual LED control enabled';
    ledSwitch.removeAttribute('aria-disabled');
  }
  if(ledOn){
    ledSwitch.classList.add('on'); ledSwitch.setAttribute('aria-checked','true');
  } else {
    ledSwitch.classList.remove('on'); ledSwitch.setAttribute('aria-checked','false');
  }
}

modeBtn.addEventListener('click', async ()=>{
  isAutomatic = !isAutomatic;
  modeBtn.textContent = isAutomatic ? 'Automatic' : 'Manual';
  const param = isAutomatic ? 'D0=1' : 'D0=0';
  await sendWrite(param);
  refreshLedUI();
});

ledSwitch.addEventListener('click', async ()=>{
  if(isAutomatic) return;
  ledOn = !ledOn;
  refreshLedUI();
  const param = ledOn ? 'D6=1' : 'D6=0';
  await sendWrite(param);
});

async function pollReads(){
  const hum = await sendRead('Humidity');
  humidityVal.textContent = (hum === null || hum === '') ? '-- %' : `${hum} %`;
  const tmp = await sendRead('Temperature');
  tempVal.textContent = (tmp === null || tmp === '') ? '-- ¬∞C' : `${tmp} ¬∞C`;
  const gas = await sendRead('GasValue');
  gasVal.textContent = (gas === null || gas === '') ? '--' : gas;
}

modeBtn.textContent = isAutomatic ? 'Automatic' : 'Manual';
refreshLedUI();
pollReads();
setInterval(pollReads, POLL_INTERVAL);
modeBtn.addEventListener('keyup', e => { if(e.key === 'Enter' || e.key === ' ') modeBtn.click(); });
</script>
</body>
</html>